---
title: 수평확장
excerpt: 로드밸런서, 오토스케일링
categories: CS
tags: [codestates, CS]
toc: true
toc_sticky: true
author_profile: true
sidebar_main: true
---
### Scale-Up
물리적으로 서버의 사양을 높이는 하드웨어적인 방법
- 서버의 수를 늘리지 않고 프로그램의 변경이 필요없음
- 높은 비용, 하드웨어의 업그레이드엔 한계가 있음

## Scale-Out
서버의 갯수를 늘려 서버의 부하를 분산시키는 방법
- 서버의 사양 업그레이드 없이, 비교적 저렴한 방법으로 부하를 처리 가능

### 로드밸런서
여러 서버에게 균등하게 트래픽을 분산시켜주는 역할
#### 로드 밸런싱
분산 처리를 해주는 기술 혹은 프로그램 
#### 종류
클라이언트의 요청을 어떤 것을 기준으로 분산시키냐에 따라 네 가지의 종류로 나뉨
- L2
  - 데이터 전송 계층에서 Mac 주소를 바탕으로 로드 밸런싱
- L3
  - 네트워크 계층에서 IP 주소를 바탕으로 로드 밸런싱
- L4
  - 전송 계층에서 IP주소와 Port를 바탕으로 로드 밸런싱 
- L7 
  - 응용 계층에서 클라이언트의 요청을 바탕으로 로드 밸런싱 
  - ex) 엔드포인트

### 오토스케일링(Auto Scaling)
자동으로 서버(리소스)를 관리해주는 기능
- 클라이언트의 요청이 많아져 서버의 처리 요구량이 증가하면 새 리소스를 자동으로 추가하고, 반대로 처리 요구량이 줄어들면 리소스를 감소시켜 적절한 분산 환경 구성

#### 장점
- 동적 스케일링
  - 사용자의 요구 수준에 따라 리소스를 동적으로 스케일링 가능
    - 스케일 업 할 수 있는 서버의 수에는 제한이 없고, 필요한 경우 서버 두 대에서 수백 ~ 수만 대의 서버로 즉시 스케일 아웃 가능
- 로드 밸런싱
  - 리소스를 동적으로 스케일업 혹은 스케일다운
  - 로드밸런서와 함께 사용하면, 다수의 EC2 인스턴스에게 워크로드를 효과적으로 분배할 수 있어 사용자가 정의한 규칙에 따라 워크로드를 효과적으로 관리 가능
- 타겟 트래킹
  - 사용자는 특정 타겟에 대해서만 Auto Scaling 가능
  - 사용자가 설정한 타겟에 맞춰 EC2 인스턴스의 수 조정
- 헬스 체크와 서버 플릿 관리 
  - EC2 인스턴스의 헬스 체크 상태를 모니터링 가능
  - 헬스 체크를 하는 과정에서 특정 인스턴스의 문제가 감지되면, 자동으로 다른 인스턴스로 교체

##### 서버 플릿(Fleet)
다수의 EC2 서버에서 애플리케이션을 호스팅 하는 경우, AWS가 이를 통칭하는 EC2 서버 집합
- Auto Scaling은 적정 수준의 서버 플릿 용량을 유지하는 데에도 도움을 줌
  - 한 대 또는 그 이상의 서버가 다운 되면 Auto Scaling은 6대의 서버 인스턴스 처리 용량을 유지하기 위해 부족분 만큼의 서버를 추가로 실행시키는 방식으로 서버 플릿을 유지

#### EC2 Auto Scaling 활용
##### 시작 템플릿(Launch Configuration)
- 인스턴스 확장 또는 축소하기 위한 서버 선택 가능
-  AMI 상세 정보, 인스턴스 타입, 키 페어, 시큐리티 그룹 등 인스턴스에 대한 모든 정보를 담고 있음
- 시작 템플릿을 사용하지 않을 경우에는 대신 시작 구성 생성 가능
  - EC2 Auto Scaling이 사용자를 위해 생성하는 EC2 인스턴스 유형을 지정
  - 사용할 AMI의 ID, 인스턴스 유형, 키 페어, 보안 그룹 등의 정보를 포함시켜 시작 구성 생성
##### Auto Scaling 그룹 생성
- 스케일업 및 스케인 다운 규칙의 모음
- EC2 인스턴스 시작부터 삭제까지의 모든 동작에 대한 규칙과 정책을 담고 있음
  - Auto Scaling 그룹 생성을 위해서는 스케일링 정책 및 유형에 대한 숙지가 필요

###### Scaling 유형
- 인스턴스 레벨 유지
  - = 기본 스케일링 계획
  - 항상 실행 상태를 유지하고자 하는 인스턴스의 수를 지정 가능
  - 일정한 수의 인스턴스가 필요한 경우 최소, 최대 및 원하는 용량에 동일한 값 설정 가능
- 수동 스케일링
  - 기존 Auto Scaling 그룹의 크기를 수동으로 변경 가능
  - 사용자가 직접 콘솔이나, API, CLI 등을 이용해 수동으로 인스턴스를 추가 또는 삭제 해야 함
- 일정별 스케일링
  - 예측 스케일링트래픽의 변화를 예측할 수 있고, 특정 시간대에 어느 정도의 트래픽이 증가하는지 패턴을 파악하고 있다면 추천하는 유형
    - 낮 시간대에는 트래픽이 최고치에 이르고 밤 시간대에는 트래픽이 거의 없다면, 낮 시간대에 서버를 증설하고 밤 시간대에 스케일 다운하는 규칙 추가
- 동적 스케일링
  - 수요 변화에 대응하여 Auto Scaling 그룹의 용량을 조정하는 방법을 정의
  - CloudWatch가 모니터링 하는 지표를 추적하여 경보 상태일 때 수행할 스케일링 규칙을 정함
    - CPU 처리 용량의 80% 수준까지 급등한 상태가 5분 이상 지속될 경우 Auto Scaling이 작동돼 새 서버를 추가
  - 항상 스케일 업과 스케일 다운 두 가지의 정책 작성 필요

