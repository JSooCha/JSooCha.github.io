---
title: Docker
excerpt: 배포 컨테이너
categories: Spring
tags: [codestates, Spring]
toc: true
toc_sticky: true
author_profile: true
sidebar_main: true
---
## 도커(Docker)
- 컨테이너 기반 오픈소스 가상화 플랫폼
- 프로그램과 실행환경을 컨테이너로 추상화하고 동일한 인터페이스를 제공하여 프로그램의 배포 및 관리 단순화
  - 어떤 프로그램이든 컨테이너로 추상화 가능
    - 백엔드 프로그램, 데이터베이스 서버, 메시지 큐 등
  - 어디에서든 실행 가능
    - 조립PC, AWS, Azure, Google cloud 등

### 컨테이너 방식의 장점

#### 의존성 충돌 문제 해결
- 애플리케이션을 컨테이너 내에 구성
  - 각 컨테이너마다 실행 환경(의존성) 격리

##### 격리되는 자원
- 프로세스
  - 해당 컨테이너 안에서만 작동 가능
  - 다른 컨테이너의 프로세스에게 영향을 줄 수 없음
- 네트워크
  - 각 컨테이너마다 IP 주소 할당
- 파일 시스템
  - 구획화
    - 해당 컨테이너에서의 명령이나 파일 등의 액세스 제한

#### 개발과 배포 환경 일치화
- OS에 상관없이 실행환경 구성 가능
- 애플리케이션 구성 자체를 컨테이너화하여 모든 실행환경 구성 가능
  - YAML 파일 + 명령어 
- 서버는 컨테이너에 담긴 애플리케이션을 실행하는 방식으로 서비스 제공
  - AWS EC2를 통해 애플리케이션을 도커 컨테이너 째로 배포 가능

#### 수평 확장과 새로운 내용의 배포 간편화
- 서비스 제공자는 트래픽 분산을 위해 프록시 서버 운영
  - 프록시 서버는 여러 동일한 검색 서버 중 하나를 골라 이용하게 함
  - 로드 밸런서(리버스 프록시의 한 종류)
- 더 많은 트래픽으로 인한 서버 증설에 컨테이너 이용
  - 동일한 애플리케이션 구성을 바탕으로, 새로운 서버에 해당 애플리케이션을 컨테이너로 실행하고, 로드 밸런서에 서버 추가
- 새로운 버전의 애플리케이션을 여러 서버 중 몇 대에만 운영하여 테스트하는 방법도 가능
  - 애플리케이션의 문제 확인
  - 전체 사용자의 영향 확산 방지
  - 오케스트레이션 도구(오케스트레이터)
    - 쿠버네티스

### 이미지 
- 애플리케이션 및 애플리케이션 구성을 함께 담아놓은 템플릿
- 모든 컨테이너는 이미지로 생성
  - 다수의 컨테이너 생성 및 수평 확장 가능
- 기본 이미지(base image)로부터 변경 사항을 추가/커밋하여 또 다른 이미지 생성 가능
  - 스프링부트 초기 세팅 이미지를 기본 이미지로 삼고 만든 애플리케이션을 추가해 넣고, 다시 이미지화

### 레지스트리
- 이미지는 레지스트리에 저장
- 도커 CLI에서 이미지를 이용해 컨테이너를 생성할 때, 호스트 컴퓨터에 이미지가 존재하지 않는다면 기본 레지스트리로부터 다운로드 
- Docker Hub, Amazon ECR

### 컨테이너와 가상 머신(VM)
- 프로세스, 네트워크, 파일 시스템 격리
#### 가상 머신(VM)
- 생성 및 실행 과정에 많은 컴퓨팅 자원 필요
- 모든 VM에 운영체제 설치 필요
#### 컨테이너
- 한 호스트 컴퓨터에서의 여러 개의 컨테이너 실행에 큰 무리가 없음
- 도커 이미지는 보통 애플리케이션 단위로 생성
  - 각 컨테이너는 호스트 OS의 커널(Kernel, 시스템 콜과 같이 OS의 핵심 기능을 구현한 프로그램)을 공유

> ##### 컨테이너에 OS를 올리지 않는데, Docker Hub에 각종 OS 이미지가 있는 이유
- 우분투, CentOS 등은 결국 동일한 리눅스 커널 위에서 만들어진 것
  - 각자가 고유의 디렉토리 구조, 패키지 시스템(apt, yum), 쉘(bash, zsh) 등을 사용했을 뿐
- OS 이미지는 컨테이너 내 애플리케이션 구성의 편의를 위해 존재하는 이미지
  - 우분투, CentOS 이미지를 사용한다고 해도 결코 컨테이너에 커널 수준의 OS가 올라가지 않음

> ##### 윈도우나 macOS는 리눅스가 아닌데, 컨테이너 안에서 리눅스 기반으로 작동하는 원리
- 리눅스 커널을 쓰고 있지 않으므로, 리눅스 커널을 VM의 형태로 실행시키는 하이퍼바이저(Hyper-V, LinuxKit, HyperKit)를 자체적으로 구동
- 윈도우용 또는 macOS용 도커는 하이퍼바이저 위의 리눅스 커널을 사용하는 것
  - 윈도우는 WSL를 통해서도 리눅스 커널 사용 가능
- 윈도우용 도커는 윈도우 커널을 사용한 윈도우 전용 컨테이너를 실행할 수 있는 기능 제공
  - 컨테이너는 커널을 공유하므로, 윈도우 커널을 사용하는 컨테이너는 리눅스용 도커에서 사용 불가

  ##### 하이퍼바이저
  - VM을 생성하고 구동하는 소프트웨어
  - VMware, VirtualBox
