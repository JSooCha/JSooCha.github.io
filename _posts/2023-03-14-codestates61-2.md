---
title: Cookie
excerpt: Cookie
categories: CS
tags: [codestates, CS]
toc: true
toc_sticky: true
author_profile: true
sidebar_main: true
---

# Cookie
- 서버가 클라이언트에 데이터를 저장하고 불러올 수 있는 수단
- 사용자 선호 테마 등 장시간 보존해야하는 정보 저장에 적합

## 특징
- 해당 도메인에 대해 쿠키가 존재하면,웹 브라우저는 도메인에게 http 요청 시 쿠키를 함께 전달
- 데이터를 저장한 이후 특정 조건(옵션)들이 만족하는 경우에만 다시 가져올 수 있음

### 옵션
- Domain : 서버와 요청의 도메인이 일치하는 경우 쿠키 전송
  - 포트 및 서브 도메인 정보, 세부 경로를 포함하지 않음
- Path : 서버와 요청의 세부경로가 일치하는 경우 쿠키 전송
  - 세부경로 : 서버가 라우팅할 때 사용하는 경로(기본 : /)
  - 설정된 path를 전부 만족하는 경우 요청하는 Path가 추가로 더 존재하더라도 쿠키를 서버에 전송할 수 있음   
  -> Path가 /users로 설정되어 있고, 요청하는 세부 경로가 /users/codestates 인 경우라면 쿠키 전송 가능
- MaxAge / Expires : 쿠키의 유효기한 설정
  - MaxAge : 초 단위 지정
  - Expires : Date 지정 (클라이언트 시간 기준)
  - 세션 쿠키 : MaxAge 또는 Expires 옵션이 없는 쿠키로, 브라우저가 실행 중일 때 사용할 수 있는 임시 쿠키. 브라우저를 종료하면 해당 쿠키는 삭제
  - 영속성 쿠키 : 브라우저의 종료 여부와 상관없이 MaxAge / Expires에 지정된 유효시간만큼 사용가능한 쿠키
- HttpOnly : 자바스크립트의 쿠키 접근 가능 여부 결정
  - true로 설정된 경우, 자바스크립트에서는 쿠키에 접근 불가
  - 쿠키는 \<script\> 태그로 접근 가능 -> XSS 공격에 취약
- Secure : Https 프로토콜에서만 쿠키 전송 여부 결정
  - true로 설정된 경우, https 프로토콜을 이용하여 통신하는 경우에만 쿠키 전송 가능
- SameSite : Cross-Origin 요청의 경우 옵션 및 메서드에 따라 쿠키 전송 여부 결정
  - Lax : GET 메서드 요청만 쿠키 전송 가능
  - Strict : Cross-Origin이 아닌 same-site 인 경우에만 쿠키
   전송 가능
    - Cross-origin : 프로토콜, 도메인, 포트가 다른 경우
    - same-site : 요청을 보낸 Origin과 서버의 도메인, 프로토콜, 포트가 같은 경우
  - None : 항상 쿠키 전송 가능
    - Secure 쿠키 옵션 필요
  - 이러한 옵션들을 지정한 다음 서버에서 클라이언트로 쿠키를 처음 전송하게 된다면 헤더에 Set-Cookie라는 프로퍼티에 쿠키를 담아 쿠키 전송
  - 이후 클라이언트 혹은 서버에서 쿠키를 전송해야 한다면 클라이언트는 헤더에 Cookie라는 프로퍼티에 쿠키를 담아 서버에 쿠키 전송

### 쿠키를 이용한 상태 유지
- 쿠키의 특성을 이용하여 서버는 클라이언트에 인증정보를 담은 쿠키를 전송하고, 클라이언트는 전달받은 쿠키를 요청과 같이 전송하여 Stateless 한 인터넷 연결을 Stateful 하게 유지 가능
- 기본적으로는 쿠키는 오랜 시간 동안 유지될 수 있고, 자바스크립트를 이용해서 쿠키에 접근할 수 있기 때문에 쿠키에 민감한 정보를 담는 것은 위험



심화 학습
쿠키 옵션 중 하나인 same-site에 대한 정확한 이해를 위해 same-origin과의 차이에 대하여 알아보세요.
위키피디아 - Same-origin Policy
쿠키를 탈취한 후 악용할 수 있는 대표적인 보안 공격에 대해 궁금하시다면 아래 링크를 참고해 주세요.
위키피디아 - XSS(사이트 간 스크립팅)
위키피디아 - CSRF(사이트 간 요청 위조)