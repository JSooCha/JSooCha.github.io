---
title: 토큰 기반 자격 증명
excerpt: Session vs. Token
categories: Spring
tags: [codestates, Spring]
toc: true
toc_sticky: true
author_profile: true
sidebar_main: true
---

## HTTP 프로토콜
- request를 전송한 후, response를 수신하게 되면 연결을 끊는 비 연결성
- request와 response에 대한 상태를 저장하지 않는 비 상태성  
= 로그인 인증에 성공해도 서버 측에서는 request를 수신할 때마다 이 request가 인증된 사용자가 보낸 request인지 알 방법이 없음 -> 인증된 사용자 request의 상태를 유지하기 위한 수단 필요

## 세션(Session)
클라이언트에서 서버의 리소스를 요청하면 서버에서 세션 저장소의 세션 정보와 사용자의 정보가 일치하는지 확인
- 인증된 사용자 정보를 서버 측 세션 저장소에서 세션 형태로 관리
- 세션 ID(생성된 사용자 세션의 고유 ID)는 클라이언트의 쿠키에 저장되어 request 전송 시, 인증된 사용자인지 증명하는 수단으로 사용
- 클라이언트 쪽에서 세션 ID만 사용하므로 상대적으로 적은 네트워크 트래픽 사용
- 서버 측에서 세션 정보를 관리하므로 보안성 측면에서 유리
- 서버의 확장성 면에서는 세션 불일치 문제가 발생할 가능성이 높음   
-> Sticky Session, Session Clustering, Session 저장소의 외부 분리 등의 작업을 통해 보완
- 세션 데이터가 많아질수록 서버의 부담이 가중될 수 있음
- SSR(Server Side Rendering) 방식의 애플리케이션에 적합한 방식

## 토큰(Token)
- 토큰에 포함된 인증된 사용자 정보를 서버 측에서 별도로 관리하지 않음
- 생성된 토큰을 헤더에 포함해 request 전송 시, 인증된 사용자인지를 증명하는 수단으로 사용
- 인증된 사용자 정보를 토큰 내에 포함하므로 세션에 비해 상대적으로 많은 네트워크 트래픽 사용
- 서버 측에서 토큰을 관리하지 않으므로 보안성 측면에서 불리
- 인증된 사용자 request의 상태를 유지할 필요가 없기 때문에 서버의 확장성 면에서 유리하고, 세션 불일치 같은 문제가 발생하지 않음
- 토큰에 포함되는 사용자 정보는 토큰의 특성상 암호화가 되지 않기 때문에 공격자에게 토큰이 탈취될 경우 사용자 정보가 그대로 노출될 수 있음 -> 민감한 정보를 포함하지 말아야 함
- 기본적으로 토큰이 만료되기 전까지는 토큰을 무효화시킬 수 없음  
-> key/value 쌍의 형태로 저장되는 Redis 같은 인메모리 DB에 무효화시키고자 하는 토큰의 만료 시간을 짧게 주어 해당 토큰을 사용하지 못하게 하여 토큰 무효화 문제를 보완
- CSR(Client Side Rendering) 방식의 애플리케이션에 적합한 방식




세션의 경우 서버 확장 시, 세션 불일치 문제가 발생할 수 있지만 Sticky Session, Session Clustering, Session 저장소의 외부 분리 등의 작업을 통해 보완하고 있습니다.

그리고 토큰의 경우, 기본적으로 토큰 무효화를 할 수 없지만 key/value 쌍의 형태로 저장되는 Redis 같은 인메모리 DB에 무효화시키고자 하는 토큰의 만료 시간을 짧게 주어 해당 토큰을 사용하지 못하게 하는 등의 방법을 사용해 토큰 무효화 문제를 보완하고 있습니다.

핵심 포인트
세션 기반 자격 증명 방식은 서버 측에 인증된 사용자의 정보를 세션 형태로 세션 저장소에 저장하는 방식이다.

세션 기반 자격 증명의 특징

세션은 인증된 사용자 정보를 서버 측 세션 저장소에서 관리한다.

생성된 사용자 세션의 고유 ID인 세션 ID는 클라이언트의 쿠키에 저장되어 request 전송 시, 인증된 사용자인지를 증명하는 수단으로 사용된다.

세션 ID만 클라이언트 쪽에서 사용하므로 상대적으로 적은 네트워크 트래픽을 사용한다.

서버 측에서 세션 정보를 관리하므로 보안성 측면에서 조금 더 유리하다.

서버의 확장성 면에서는 세션 불일치 문제가 발생할 가능성이 높다.

세션 데이터가 많아지면 질수록 서버의 부담이 가중될 수 있다.

SSR(Server Side Rendering) 방식의 애플리케이션에 적합한 방식이다.

토큰 기반 자격 증명 방식은 인증된 사용자의 정보를 토큰에 저장하고, 접근 권한을 부여해 접근 권한이 부여된 특정 리소스에만 접근할 수 있게 하는 방식이다.

토큰 기반 자격 증명의 특징

토큰에 포함된 인증된 사용자 정보는 서버 측에서 별도의 관리를 하지 않는다.

생성된 토큰을 헤더에 포함해 request 전송 시, 인증된 사용자인지를 증명하는 수단으로 사용된다.

토큰 내에 인증된 사용자 정보 등을 포함하고 있으므로 세션에 비해 상대적으로 많은 네트워크 트래픽을 사용한다.

기본적으로 서버 측에서 토큰을 관리하지 않으므로 보안성 측면에서 조금 더 불리하다.

인증된 사용자 request의 상태를 유지할 필요가 없기 때문에 서버의 확장성 면에서 유리하고, 세션 불일치 같은 문제가 발생하지 않는다.

토큰에 포함되는 사용자 정보는 토큰의 특성상 암호화가 되지 않기 때문에 공격자에게 토큰이 탈취될 경우, 사용자 정보를 그대로 제공하는 셈이 되므로 민감한 정보는 토큰에 포함하지 말아야 한다.

기본적으로 토큰이 만료되기 전까지는 토큰을 무효화시킬 수 없다.

CSR(Client Side Rendering) 방식의 애플리케이션에 적합한 방식이다.



심화 학습
Sticky Session에 대해서 더 알아보고 싶다면 아래 링크를 참고하세요.

https://www.imperva.com/learn/availability/sticky-session-persistence-and-cookies/
Session Clustering에 대해서 더 알아보고 싶다면 아래 링크를 참고하세요.

https://zetawiki.com/wiki/세션_클러스터링

https://tomcat.apache.org/tomcat-8.5-doc/cluster-howto.html