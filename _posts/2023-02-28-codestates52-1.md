---
title: íŠ¸ëœì­ì…˜(Transaction)ì´ë€?
excerpt: íŠ¸ëœì­ì…˜ ê°œìš”
categories: Spring
tags: [codestates, Spring]
toc: true
toc_sticky: true
author_profile: true
sidebar_main: true
published : false
---

[ê¸°ë³¸] íŠ¸ëœì­ì…˜(Transaction)ì´ë€?
íŠ¸ëœì­ì…˜(Transaction)ì´ë€?
íŠ¸ëœì­ì…˜ì´ë€ ë¬´ì—‡ì¼ê¹Œìš”?

ìš°ë¦¬ê°€ ë§Œë“¤ê³  ìˆëŠ” ì»¤í”¼ ì£¼ë¬¸ ìƒ˜í”Œ ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ íŠ¸ëœì­ì…˜ì˜ ê°œë…ì„ ì§ê´€ì ìœ¼ë¡œ ì•Œ ìˆ˜ ìˆëŠ” ì‚¬ë¡€ë¥¼ ëª‡ ê°€ì§€ ë“¤ì–´ë³´ê² ìŠµë‹ˆë‹¤.


ì‚¬ë¡€ 1
íšŒì›ì´ ì»¤í”¼ ì£¼ë¬¸ ì•±ìœ¼ë¡œ ì¹´í˜ë¼ë–¼ ë‘ ì”ì„ ì„ íƒí•˜ê³  ê²°ì œ ë²„íŠ¼ì„ ëˆ„ë¥¸ í›„, ì£¼ë¬¸ì´ ì§„í–‰ë˜ëŠ” ì¤‘ì— ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ë¡œ ì¸í•´ ê²°ì œë¥¼ ì™„ë£Œí•˜ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.

ê·¸ëŸ°ë°, íšŒì›ì´ ì£¼ë¬¸í•œ ì£¼ë¬¸ì´ ì •ìƒì ìœ¼ë¡œ ë°ì´í„°ë² ì´ìŠ¤ì— ë“±ë¡ì´ ë˜ê³ , ì£¼ë¬¸í•œ ì»¤í”¼ ìˆ˜ë§Œí¼ì˜ ìŠ¤íƒ¬í”„ê°€ ì°í˜”ìŠµë‹ˆë‹¤.

ì´ ê²½ìš°, ì¹´í˜ë¥¼ ìš´ì˜í•˜ëŠ” ìª½ì—ì„œëŠ” íŒë§¤ ìˆ˜ìµì„ ì–»ì§€ ëª»í•˜ëŠ” ì†í•´ë¥¼ ë³¼ ê²ƒì…ë‹ˆë‹¤. ë°˜ë©´ì— íšŒì›ì€ ê³µì§œ ì»¤í”¼ë¥¼ ë§ˆì‹œê²Œ ë˜ëŠ” ì…ˆì…ë‹ˆë‹¤.


ì‚¬ë¡€ 2
ë°˜ëŒ€ë¡œ íšŒì›ì´ ì£¼ë¬¸í•œ ì»¤í”¼ì— ëŒ€í•œ ê²°ì œëŠ” ì™„ë£Œë˜ì—ˆëŠ”ë°, ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥í•˜ëŠ” ì¤‘ì— ì—ëŸ¬ê°€ ë°œìƒí•´ì„œ íšŒì›ì´ ì£¼ë¬¸í•œ ì»¤í”¼ ì£¼ë¬¸ ì •ë³´ê°€ ë°ì´í„°ë² ì´ìŠ¤ì— ì •ìƒì ìœ¼ë¡œ ë“±ë¡ì´ ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.

ì´ ê²½ìš°, íšŒì›ì€ ì»¤í”¼ë„ ë§ˆì‹œì§€ ëª»í•œ ì±„ ê¸ˆì „ì ì¸ ì†í•´ë§Œ ë³¼ ê²ƒì…ë‹ˆë‹¤.


ì‚¬ë¡€ 3
ë§ˆì§€ë§‰ìœ¼ë¡œ íšŒì›ì˜ ì»¤í”¼ ì£¼ë¬¸ì€ ì •ìƒì ìœ¼ë¡œ ë°ì´í„°ë² ì´ìŠ¤ì— ë“±ë¡ì´ ë˜ì—ˆëŠ”ë°, ì£¼ë¬¸í•œ ì»¤í”¼ ìˆ˜ë§Œí¼ì˜ ìŠ¤íƒ¬í”„ íšŸìˆ˜ë¥¼ ë°ì´í„°ë² ì´ìŠ¤ì— ì—…ë°ì´íŠ¸í•˜ëŠ” ì¤‘ì— ì—ëŸ¬ê°€ ë°œìƒí•´ì„œ ì»¤í”¼ ì£¼ë¬¸ì€ ì™„ë£Œë˜ì—ˆì§€ë§Œ ë‚˜ì¤‘ì— í™•ì¸í•´ ë³´ë‹ˆ ìŠ¤íƒ¬í”„ê°€ ëˆ„ì ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.

ì´ ê²½ìš°, íšŒì›ì€ ì»¤í”¼ëŠ” ë§ˆì‹œì§€ë§Œ ì•„ê¹Œìš´ ìŠ¤íƒ¬í”„ íšŸìˆ˜ë¥¼ ìƒê²Œ ë  ê²ƒì…ë‹ˆë‹¤.


ìœ„ì—ì„œ ì´ì•¼ê¸° í•œ ì„¸ ê°€ì§€ ì‚¬ë¡€ì˜ ê³µí†µì ì€ ë¬´ì—‡ì¼ê¹Œìš”?


ë‘ ê°œì˜ ì‘ì—…ë“¤ì´ ë§ˆì¹˜ í•˜ë‚˜ì˜ ê·¸ë£¹ì²˜ëŸ¼ ë¬¶ì—¬ì„œ ì²˜ë¦¬ë˜ëŠ” ì¤‘ì— ë‘˜ ì¤‘ í•˜ë‚˜ë¼ë„ ì²˜ë¦¬ì— ì‹¤íŒ¨í•  ê²½ìš° ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ì‹ ë¢°ì„±ì´ ê¹¨ì§€ëŠ” ìƒí™©ì´ ë°œìƒí•˜ê³  ìˆìŠµë‹ˆë‹¤.


ì´ì²˜ëŸ¼ íŠ¸ëœì­ì…˜ì€ ì—¬ëŸ¬ ê°œì˜ ì‘ì—…ë“¤ì„ í•˜ë‚˜ì˜ ê·¸ë£¹ìœ¼ë¡œ ë¬¶ì–´ì„œ ì²˜ë¦¬í•˜ëŠ” ì²˜ë¦¬ ë‹¨ìœ„ì¸ë°, ì•ì—ì„œ ë³¸ ì‚¬ë¡€ì²˜ëŸ¼ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ì‹ ë¢°ì„±ì´ ê¹¨ì§€ëŠ” ìƒí™©ì´ ë°œìƒí•˜ë©´ íŠ¸ëœì­ì…˜ì´ë¼ê³  ë¶€ë¥¼ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.


ë¬´ì¡°ê±´ ì—¬ëŸ¬ ê°œì˜ ì‘ì—…ì„ ê·¸ë£¹ìœ¼ë¡œ ë¬¶ëŠ”ë‹¤ê³  í•´ì„œ íŠ¸ëœì­ì…˜ì´ë¼ê³  ë¶€ë¥¼ ìˆ˜ ìˆëŠ” ê²Œ ì•„ë‹ˆë¼ ë¬¼ë¦¬ì ìœ¼ë¡œëŠ” ì—¬ëŸ¬ ê°œì˜ ì‘ì—…ì´ì§€ë§Œ ë…¼ë¦¬ì ìœ¼ë¡œëŠ” ë§ˆì¹˜ í•˜ë‚˜ì˜ ì‘ì—…ìœ¼ë¡œ ì¸ì‹í•´ì„œ ì „ë¶€ ì„±ê³µí•˜ë“ ê°€ ì „ë¶€ ì‹¤íŒ¨í•˜ë“ ê°€(All or Nothing)ì˜ ë‘˜ ì¤‘ í•˜ë‚˜ë¡œë§Œ ì²˜ë¦¬ë˜ì–´ì•¼ íŠ¸ëœì­ì…˜ì˜ ì˜ë¯¸ë¥¼ ê°€ì§‘ë‹ˆë‹¤.


ì´ëŸ¬í•œ All or Nothingì´ë¼ëŠ” íŠ¸ëœì­ì…˜ ì²˜ë¦¬ ë°©ì‹ì€ ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ì‚¬ìš©í•˜ëŠ” ë°ì´í„°ì˜ ë¬´ê²°ì„±ì„ ë³´ì¥í•˜ëŠ” í•µì‹¬ì ì¸ ì—­í• ì„ í•©ë‹ˆë‹¤.


ìš°ë¦¬ê°€ ë§Œë“  ì»¤í”¼ ì£¼ë¬¸ ìƒ˜í”Œ ì• í”Œë¦¬ì¼€ì´ì…˜ì—ëŠ” ì•„ì§ íŠ¸ëœì­ì…˜ì´ ì ìš©ë˜ì§€ ì•Šì•˜ê¸° ë•Œë¬¸ì— ì•ì—ì„œ ì‚´í´ë³¸ ì‚¬ë¡€ì™€ ê°™ì€ ì ì¬ì ì¸ ë¬¸ì œì ì„ ê³ ìŠ¤ë€íˆ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤.

ì´ ë¬¸ì œëŠ” íŠ¸ëœì­ì…˜ì— ëŒ€í•´ ì–´ëŠ ì •ë„ í•™ìŠµí•œ ë’¤ì— ê°œì„ í•´ ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.


ACID ì›ì¹™
ìš°ë¦¬ê°€ íŠ¸ëœì­ì…˜ì˜ íŠ¹ì§•ì„ ì´ì•¼ê¸°í•  ë•ŒëŠ” ì¼ë°˜ì ìœ¼ë¡œ ACIDë¼ëŠ” ì›ì¹™ì„ ì´ìš©í•©ë‹ˆë‹¤.

ACIDê°€ ì–´ë–¤ ì›ì¹™ì„ ì˜ë¯¸í•˜ëŠ”ì§€ ê°„ë‹¨íˆ ì‚´í´ë³´ê² ìŠµë‹ˆë‹¤.


ì›ìì„±(Atomicity)
íŠ¸ëœì­ì…˜ì—ì„œì˜ ì›ìì„±ì´ë€ ì‘ì—…ì„ ë” ì´ìƒ ìª¼ê°¤ ìˆ˜ ì—†ìŒì„ ì˜ë¯¸í•©ë‹ˆë‹¤.


ìš°ë¦¬ê°€ ì•ì—ì„œ ì‚´í´ë³¸ íŠ¸ëœì­ì…˜ ìƒí™© 3ì„ ì˜ˆë¥¼ ë“¤ë©´, ì»¤í”¼ ì£¼ë¬¸ ì‘ì—…ê³¼ ìŠ¤íƒ¬í”„ íšŸìˆ˜ë¥¼ ì¦ê°€ì‹œí‚¤ëŠ” ë‘ ì‘ì—…ì€ ì–´ë–¤ ì‘ì—…ì€ ì²˜ë¦¬í•´ë„ ë˜ê³ , ì–´ë–¤ ì‘ì—…ì€ ì²˜ë¦¬í•˜ì§€ ì•Šì•„ë„ ë˜ëŠ” ì‹ìœ¼ë¡œ ìª¼ê°œì„œ ì²˜ë¦¬í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.

ë”°ë¼ì„œ ë…¼ë¦¬ì ìœ¼ë¡œ í•˜ë‚˜ì˜ ì‘ì—…ìœ¼ë¡œ ì¸ì‹í•´ì„œ ë‘˜ ë‹¤ ì„±ê³µí•˜ë“ ê°€ ë‘˜ ë‹¤ ì‹¤íŒ¨í•˜ë“ ê°€(All or Nothing) ì¤‘ì—ì„œ í•˜ë‚˜ë¡œë§Œ ì²˜ë¦¬ë˜ëŠ” ê²ƒì´ ë³´ì¥ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.


ì¼ê´€ì„±(Consistency)
ì¼ê´€ì„±ì€ íŠ¸ëœì­ì…˜ì´ ì—ëŸ¬ ì—†ì´ ì„±ê³µì ìœ¼ë¡œ ì¢…ë£Œë  ê²½ìš°, ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì—ì„œ ì˜ë„í•˜ëŠ” ëŒ€ë¡œ ì¼ê´€ì„± ìˆê²Œ ì €ì¥ë˜ê±°ë‚˜ ë³€ê²½ë˜ëŠ” ê²ƒì„ ì˜ë¯¸í•©ë‹ˆë‹¤.


íŠ¸ëœì­ì…˜ ìƒí™© 3ì˜ ì˜ˆì—ì„œëŠ” ì£¼ë¬¸í•œ ì»¤í”¼ì˜ ìˆ˜ë§Œí¼, ìŠ¤íƒ¬í”„ íšŸìˆ˜ê°€ ì¦ê°€í•œë‹¤ëŠ” ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì— ë§ê²Œ ì €ì¥ë˜ê±°ë‚˜ ë³€ê²½ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.


ì¦‰, íšŒì›ì´ 3ì”ì˜ ì»¤í”¼ë¥¼ ì£¼ë¬¸í–ˆìœ¼ë©´ ìŠ¤íƒ¬í”„ íšŸìˆ˜ê°€ 3 ì¦ê°€í•œ ê°’ìœ¼ë¡œ ì €ì¥ì´ ë˜ì–´ìˆì„ ê±°ë¼ê³  ì˜ˆìƒí–ˆëŠ”ë°, 3ì´ ì•„ë‹Œ ìˆ«ìë¡œ ì¦ê°€í•œ ê°’ì´ ì¡°íšŒëœë‹¤ë©´ ì¼ê´€ì„±ì— ìœ„ë°°ë˜ëŠ” ê²ƒì…ë‹ˆë‹¤.


ê²©ë¦¬ì„±(Isolation)
ê²©ë¦¬ì„±ì€ ì—¬ëŸ¬ ê°œì˜ íŠ¸ëœì­ì…˜ì´ ì‹¤í–‰ë  ê²½ìš° ê°ê° ë…ë¦½ì ìœ¼ë¡œ ì‹¤í–‰ì´ ë˜ì–´ì•¼ í•¨ì„ ì˜ë¯¸í•©ë‹ˆë‹¤.


ê²©ë¦¬ì„±ì„ ì´í•´í•˜ê¸° ìœ„í•´ì„œëŠ” CPUê°€ í”„ë¡œì„¸ìŠ¤ë¥¼ ì²˜ë¦¬í•˜ëŠ” ê³¼ì •ì„ ì´í•´í•˜ê³  ìˆëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤.

ì˜ˆë¥¼ ë“¤ì–´ ìš°ë¦¬ê°€ ì»´í“¨í„°ì—ì„œ ì›Œë“œ ì‘ì—…ì„ í•˜ê³  ìˆê³ , ë™ì‹œì— ë®¤ì§ í”Œë ˆì´ì–´ë¡œ ìŒì•…ì„ ë“£ê³  ìˆë‹¤ë©´ ìš°ë¦¬ ëˆˆì—ëŠ” ë³´ì´ì§€ ì•Šì§€ë§Œ CPUëŠ” ìœ„ ë‘ ê°€ì§€ í”„ë¡œì„¸ìŠ¤ë¥¼ ì•„ì£¼ ë¹ ë¥¸ ì†ë„ë¡œ ë²ˆê°ˆì•„ê°€ë©´ì„œ ì‹¤í–‰ì„ ì‹œí‚¤ëŠ” ê²ƒì…ë‹ˆë‹¤.


ì´ì²˜ëŸ¼ ë°ì´í„°ë² ì´ìŠ¤ ì—­ì‹œ ì„±ëŠ¥ í–¥ìƒì„ ëª©ì ìœ¼ë¡œ í•œ ê°œ ì´ìƒì˜ íŠ¸ëœì­ì…˜ì„ ë²ˆê°ˆì•„ê°€ë©´ì„œ ì²˜ë¦¬í•  ìˆ˜ ìˆëŠ”ë°, ì´ ê²½ìš° ê° íŠ¸ëœì­ì…˜ì´ ë‹¤ë¥¸ íŠ¸ëœì­ì…˜ì— ì˜í–¥ì„ ì£¼ì§€ ì•Šê³  ë…ë¦½ì ìœ¼ë¡œ ì‹¤í–‰ì´ ë˜ì–´ì•¼ í•œë‹¤ëŠ” ê²ƒì´ ë°”ë¡œ ê²©ë¦¬ì„±(Isolation)ì…ë‹ˆë‹¤.




4. ì§€ì†ì„±(Durability)
íŠ¸ëœì­ì…˜ì´ ì™„ë£Œë˜ë©´ ê·¸ ê²°ê³¼ëŠ” ì§€ì†ë˜ì–´ì•¼ í•œë‹¤ëŠ” ì˜ë¯¸ì…ë‹ˆë‹¤.


ì¦‰, ì§€ì†ì„±ì€ ì—¬ëŸ¬ë¶„ë“¤ì´ ì˜ ì•Œê³  ìˆë‹¤ì‹œí”¼ ë°ì´í„°ë² ì´ìŠ¤ê°€ ì¢…ë£Œë˜ì–´ë„ ë°ì´í„°ëŠ” ë¬¼ë¦¬ì ì¸ ì €ì¥ì†Œì— ì €ì¥ë˜ì–´ ì§€ì†ì ìœ¼ë¡œ ìœ ì§€ë˜ì–´ì•¼ í•œë‹¤ëŠ” ì˜ë¯¸ì…ë‹ˆë‹¤.


íŠ¸ëœì­ì…˜ ì»¤ë°‹(commit)ê³¼ ë¡¤ë°±(rollback)
íŠ¸ëœì­ì…˜ì„ ì´ì•¼ê¸°í•˜ëŠ” ë° ìˆì–´ ì»¤ë°‹(commit)ê³¼ ë¡¤ë°±(rollback)ì„ ë¹¼ë†“ê³  ì´ì•¼ê¸°í•  ìˆ˜ëŠ” ì—†ìŠµë‹ˆë‹¤.

ì»¤ë°‹(commit)ê³¼ ë¡¤ë°±(rollback)ì€ ì—¬ëŸ¬ë¶„ë“¤ì´ ì˜ ì•Œê³  ìˆë‹¤ì‹œí”¼ ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ì‚¬ìš©ë˜ëŠ” ëª…ë ¹ì–´ì¸ë°, ì§€ê¸ˆë¶€í„° ê·¸ íŠ¹ì§•ì„ ê°„ë‹¨íˆ ì‚´í´ë³´ê² ìŠµë‹ˆë‹¤.


ì»¤ë°‹(commit)
ì»¤ë°‹(commit)ì€ ëª¨ë“  ì‘ì—…ì„ ìµœì¢…ì ìœ¼ë¡œ ë°ì´í„°ë² ì´ìŠ¤ì— ë°˜ì˜í•˜ëŠ” ëª…ë ¹ì–´ë¡œì¨  commit ëª…ë ¹ì„ ìˆ˜í–‰í•˜ë©´ ë³€ê²½ëœ ë‚´ìš©ì´ ë°ì´í„°ë² ì´ìŠ¤ì— ì˜êµ¬ì ìœ¼ë¡œ ì €ì¥ë©ë‹ˆë‹¤.
ë§Œì•½ commit ëª…ë ¹ì„ ìˆ˜í–‰í•˜ì§€ ì•Šìœ¼ë©´ ì‘ì—…ì˜ ê²°ê³¼ê°€ ë°ì´í„°ë² ì´ìŠ¤ì— ìµœì¢…ì ìœ¼ë¡œ ë°˜ì˜ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
commit ëª…ë ¹ì„ ìˆ˜í–‰í•˜ë©´, í•˜ë‚˜ì˜ íŠ¸ëœì ì…˜ ê³¼ì •ì€ ì¢…ë£Œí•˜ê²Œ ë©ë‹ˆë‹¤.

ë¡¤ë°±(rollback)
ë¡¤ë°±(rollback)ì€ ì‘ì—… ì¤‘ ë¬¸ì œê°€ ë°œìƒí–ˆì„ ë•Œ, íŠ¸ëœì­ì…˜ ë‚´ì—ì„œ ìˆ˜í–‰ëœ ì‘ì—…ë“¤ì„ ì·¨ì†Œí•©ë‹ˆë‹¤.
ë”°ë¼ì„œ íŠ¸ëœì­ì…˜ ì‹œì‘ ì´ ì „ì˜ ìƒíƒœë¡œ ë˜ëŒì•„ê°‘ë‹ˆë‹¤.

ì»¤ë°‹(commit)ê³¼ ë¡¤ë°±(rollback)ì„ ì‰½ê²Œ ì´í•´í•˜ê¸° ìœ„í•´ ìš°ë¦¬ê°€ ë°ì´í„° ì•¡ì„¸ìŠ¤ ê³„ì¸µì„ í•™ìŠµí•˜ë©´ì„œ ì‚¬ìš©í–ˆë˜ H2 ì›¹ ì½˜ì†”ì„ ì´ìš©í•´ ì»¤ë°‹(commit)ê³¼ ë¡¤ë°±(rollback)ì— ëŒ€í•œ ëª‡ ê°€ì§€ ì˜ˆë¥¼ ë“¤ì–´ë³´ê² ìŠµë‹ˆë‹¤.



ğŸ’¡
H2 ì¸ë©”ëª¨ë¦¬ DBì˜ íŠ¹ì„±ìƒ ì»¤ë°‹(commit)ê³¼ ë¡¤ë°±(rollback) í…ŒìŠ¤íŠ¸ê°€ ì œí•œì ì´ë¯€ë¡œ, í•œ ë²ˆì˜ ì»¤ë°‹(commit) ë˜ëŠ” ë¡¤ë°±(rollback) í…ŒìŠ¤íŠ¸ í›„, ë‹¤ì‹œ í…ŒìŠ¤íŠ¸ë¥¼ ìˆ˜í–‰í•˜ê³  ì‹¶ë‹¤ë©´ IntelliJì—ì„œ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì¬ì‹¤í–‰ í›„, í…ŒìŠ¤íŠ¸ë¥¼ ì§„í–‰í•´ ì£¼ì„¸ìš”.

ì»¤ë°‹(commit)ê³¼ ë¡¤ë°±(rollback)ì˜ ê°„ë‹¨í•œ ê°œë…ì„ ì´í•´í•˜ëŠ” ê²ƒì´ ì£¼ëª©ì ì´ê¸° ë•Œë¬¸ì— MySQL ê°™ì€ ì‹¤ì œ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ì„¤ì¹˜í•˜ê³  ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ë°ì´í„°ë² ì´ìŠ¤ ì—°ë™ì„ ìœ„í•œ ì„¤ì •ì„ í•˜ëŠ” ê²ƒì´ ë²ˆê±°ë¡œìš´ ì‘ì—…ì´ ë  ìˆ˜ ìˆì–´ H2 ì¸ë©”ëª¨ë¦¬ DBë¥¼ ê·¸ëŒ€ë¡œ ì‚¬ìš©í•˜ê³  ìˆë‹¤ëŠ” ì ì„ ì—¼ë‘ì— ë‘ê¸° ë°”ëë‹ˆë‹¤.




âœ… ì»¤ë°‹(commit) ì˜ˆ

ë¨¼ì € ì—¬ëŸ¬ë¶„ë“¤ì´ í´ë¡  ë°›ì€ í…œí”Œë¦¿ í”„ë¡œì íŠ¸ì—ì„œ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì‹¤í–‰í•©ë‹ˆë‹¤.

ê·¸ë¦¬ê³  ì•„ë˜ ì£¼ì†Œë¡œ H2 ì›¹ ì½˜ì†”ì„ ì˜¤í”ˆí•˜ê³  ë°ì´í„°ë² ì´ìŠ¤ì— ì ‘ì†í•©ë‹ˆë‹¤.

H2 ì›¹ ì½˜ì†”: http://localhost:8080/h2



[ê·¸ë¦¼ 3-62] ì½”ë“œ 3-147 ì¿¼ë¦¬ë¬¸ì„ ì‹¤í–‰í•˜ê¸° ì§ì „ H2 ì½˜ì†” í™”ë©´

[ê·¸ë¦¼ 3-62]ëŠ” H2 ì›¹ ì½˜ì†”ì—ì„œ ì•„ë˜ì˜ ì½”ë“œ 3-147ì˜ ì¿¼ë¦¬ë¥¼ ì‹¤í–‰í•˜ê¸° ì „ì˜ ëª¨ìŠµì…ë‹ˆë‹¤.

ì¿¼ë¦¬ë¥¼ ì‹¤í–‰í•˜ê¸° ì „ì— [ê·¸ë¦¼ 3-62]ì—ì„œì²˜ëŸ¼ [Auto commit]ì˜ ì²´í¬ë¥¼ ë¨¼ì € í•´ì œí•´ ì£¼ì„¸ìš”.

```java
BEGIN TRANSACTION;
insert into  MEMBER VALUES 
       (1, now(), now(), 'hgd1@gmail.com', 'MEMBER_ACTIVE', 'í™ê¸¸ë™1', '010-1111-1111');
COMMIT;

BEGIN TRANSACTION;
insert into  MEMBER VALUES 
       (2, now(), now(), 'hgd2@gmail.com', 'MEMBER_ACTIVE', 'í™ê¸¸ë™2', '010-2222-2222');
```
[ì½”ë“œ 3-147] H2 ì›¹ ì½˜ì†”ì—ì„œì˜ commit ì˜ˆ

ì½”ë“œ 3-147ì„ H2 ì›¹ ì½˜ì†”ì—ì„œ ì‹¤í–‰í•˜ë©´ MEMBER í…Œì´ë¸”ì—ëŠ” ëª‡ ê°œì˜ rowê°€ ì €ì¥ë ê¹Œìš”?

ì´ ì§ˆë¬¸ì— ëŒ€í•œ ë‹µì„ ë§íˆì‹ ë‹¤ë©´ ì—¬ëŸ¬ë¶„ì€ commitì— ëŒ€í•´ì„œ ì´í•´í•œ ê²ƒì…ë‹ˆë‹¤. ^^


ì´ì œ ì¿¼ë¦¬ë¥¼ ì‹¤í–‰í•´ ë³´ê² ìŠµë‹ˆë‹¤.




[ê·¸ë¦¼ 3-63] ì½”ë“œ 3-147 ì¿¼ë¦¬ë¬¸ì„ ì‹¤í–‰ ì§í›„, H2 ì½˜ì†” í™”ë©´

ê·¸ë¦¼ 3-63ì€ ì½”ë“œ 3-147 ì¿¼ë¦¬ë¬¸ì„ ì‹¤í–‰í•œ ì§í›„ì˜ H2 ì½˜ì†” í™”ë©´ì…ë‹ˆë‹¤.

ì‹¤í–‰ ê²°ê³¼ì—ì„œëŠ” ë‘ ê°œì˜ INSERT ì¿¼ë¦¬ë¬¸ì´ ì‹¤í–‰ëœ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.


ê·¸ëŸ°ë° ì›¹ ë¸Œë¼ìš°ì €ë¥¼ refreshí•œ í›„, SELECT ì¿¼ë¦¬ë¡œ MEMBER í…Œì´ë¸”ì„ ì¡°íšŒí•˜ë©´ ê·¸ë¦¼ 3-64ì™€ ê°™ì´ 1ê°œì˜ rowë§Œ MEMBER í…Œì´ë¸”ì— ì €ì¥ì´ ëœ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.



[ê·¸ë¦¼ 3-64] ì›¹ ë¸Œë¼ìš°ì € refreshí›„ SELECT ë¬¸ ì‹¤í–‰ ê²°ê³¼

ê²°ë¡ ì ìœ¼ë¡œ ì²« ë²ˆì§¸ INSERTë¬¸ì€ ì»¤ë°‹(commit) ëª…ë ¹ì´ ìˆ˜í–‰ë˜ì—ˆê¸° ë•Œë¬¸ì— INSER ë¬¸ ìˆ˜í–‰ ê²°ê³¼ê°€ í…Œì´ë¸”ì— ë°˜ì˜ë˜ì—ˆìœ¼ë©°, ë‘ ë²ˆì§¸ INSERTë¬¸ì€ ìƒˆë¡œìš´ íŠ¸ëœì­ì…˜ì—ì„œ ì»¤ë°‹(commit) ëª…ë ¹ì´ ìˆ˜í–‰ë˜ì§€ ì•Šì•˜ê¸° ë•Œë¬¸ì— INSERTë¬¸ ìˆ˜í–‰ê²°ê³¼ê°€ í…Œì´ë¸”ì— ë°˜ì˜ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.


âœ… ë¡¤ë°±(rollback) ì˜ˆ

ê·¸ëŸ¼ ì´ì œ ë¡¤ë°±(rollback)ì— ëŒ€í•œ ì˜ˆë¥¼ í™•ì¸í•´ ë´…ì‹œë‹¤.

```java
BEGIN TRANSACTION;
insert into  MEMBER VALUES 
			(1, now(), now(), 'hgd1@gmail.com', 'MEMBER_ACTIVE', 'í™ê¸¸ë™1', '010-1111-1111');
ROLLBACK;
COMMIT;
```
[3-148] H2 ì›¹ ì½˜ì†”ì—ì„œì˜ rollback ì˜ˆ

ì½”ë“œ 3-148ì„ H2 ì›¹ ì½˜ì†”ì—ì„œ ì‹¤í–‰í•˜ë©´ ì‹¤í–‰ ê²°ê³¼ëŠ” ì–´ë–»ê²Œ ë ê¹Œìš”?




[ê·¸ë¦¼ 3-65] ì½”ë“œ 3-148 ì‹¤í–‰ í›„, SELECT ë¬¸ ì‹¤í–‰ ê²°ê³¼

ê·¸ë¦¼ 3-65ì˜ ì‹¤í–‰ ê²°ê³¼ë¥¼ ë³´ë©´ INSERTë¬¸ì´ ì‹¤í–‰ë˜ì—ˆì§€ë§Œ commit ì§ì „ì— rollback ëª…ë ¹ì„ ë¨¼ì € ìˆ˜í–‰í–ˆê¸° ë•Œë¬¸ì— íŠ¸ëœì­ì…˜ì˜ ìƒíƒœê°€ INSERTë¬¸ ìˆ˜í–‰ ì´ ì „ ìƒíƒœë¡œ ë˜ëŒì•„ê°”ìœ¼ë©°, INSERTë¬¸ì—ì„œ ì‹¤í–‰ëœ ë°ì´í„°ëŠ” í…Œì´ë¸”ì— ì €ì¥ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.


ê·¸ëŸ°ë° ë°ì´í„°ë² ì´ìŠ¤ ìƒì—ì„œ ì»¤ë°‹(commit)ê³¼ ë¡¤ë°±(rollback)ì„ ì‚¬ìš©í•˜ëŠ” ë°©ë²•ì€ ëŒ€ëµì ìœ¼ë¡œ ì•Œì•„ë³´ì•˜ì§€ë§Œ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ êµ¬í˜„í•˜ëŠ” ì…ì¥ì—ì„œëŠ” ì´ì²˜ëŸ¼ ì½˜ì†”ì„ í†µí•´ ì§ì ‘ì ìœ¼ë¡œ ë°ì´í„°ë² ì´ìŠ¤ì— ì»¤ë°‹(commit)ê³¼ ë¡¤ë°±(rollback) ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.


ì´ ë§ì€ ì• í”Œë¦¬ì¼€ì´ì…˜ êµ¬í˜„ ì½”ë“œ ìƒì—ì„œ í”„ë¡œê·¸ë˜ë° ì ìœ¼ë¡œ ì»¤ë°‹(commit)ê³¼ ë¡¤ë°±(rollback) ëª…ë ¹ì„ ë‚´ë ¤ì•¼ í•œë‹¤ëŠ” ê²ƒì…ë‹ˆë‹¤.


ìš°ë¦¬ê°€ rollback ëª…ë ¹ì€ ì•„ì§ ì‚¬ìš©í•´ ë³¸ ì ì€ ì—†ì§€ë§Œ commit ëª…ë ¹ì€ ì½”ë“œ ìƒì—ì„œ ì‚¬ìš©í•´ ë³¸ ì ì´ ìˆìŠµë‹ˆë‹¤.

ì–´ë””ì—ì„œ ì‚¬ìš©í•´ ë³´ì•˜ì„ê¹Œìš”?


JPAë¥¼ í•™ìŠµí•˜ë©´ì„œ ì‚¬ìš©í•´ ë³¸ ì ì´ ìˆìŠµë‹ˆë‹¤.

```java
import org.springframework.boot.CommandLineRunner;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;

import javax.persistence.EntityManager;
import javax.persistence.EntityManagerFactory;
import javax.persistence.EntityTransaction;

@Configuration
public class JpaBasicConfig {
    private EntityManager em;
    private EntityTransaction tx;

    @Bean
    public CommandLineRunner testJpaBasicRunner(EntityManagerFactory emFactory) {
        this.em = emFactory.createEntityManager();
        
				// (1)
				this.tx = em.getTransaction();

        return args -> {
            tx.begin();
            Member member = new Member("hgd@gmail.com");

            em.persist(member);
					
            tx.commit();    // (2)
        };
    }
}
```
[3-149] JPA ì½”ë“œì—ì„œ commitì„ ì‚¬ìš©í•˜ëŠ” ì˜ˆ

ì½”ë“œ 3-149ëŠ” ìš°ë¦¬ê°€ JPA ì±•í„°ì—ì„œ í•™ìŠµí–ˆë˜ ì½”ë“œì˜ ì¼ë¶€ì…ë‹ˆë‹¤.


(1)ì—ì„œ EntityManager ê°ì²´ë¥¼ í†µí•´ Transaction ê°ì²´ë¥¼ ì–»ì€ í›„ì— (2)ì—ì„œ commit() ë©”ì„œë“œë¥¼ í˜¸ì¶œí•´ì„œ ë³€ê²½ ì‚¬í•­ì„ ìµœì¢…ì ìœ¼ë¡œ ë°˜ì˜ì„ í•˜ê³  ìˆëŠ” ê±¸ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.


JPAì˜ tx.commit() ë‚´ë¶€ ë“¤ì—¬ë‹¤ë³´ê¸°
ê·¸ë ‡ë‹¤ë©´ ì½”ë“œ 3-149ì™€ ê°™ì´ JPAì—ì„œ ì‚¬ìš©í•´ ë³´ì•˜ë˜ commit()ì€ í”„ë¡œê·¸ë˜ë°ì ìœ¼ë¡œëŠ” ì–´ë–¤ ê³¼ì •ì„ ê±°ì³ì„œ ë°ì´í„°ë² ì´ìŠ¤ì— commit ëª…ë ¹ì–´ë¥¼ ì „ë‹¬í•˜ëŠ” ê±¸ê¹Œìš”?

ì½”ë“œ 3-149ì˜ tx.commit() ë‚´ë¶€ë¥¼ ì‚´ì§ ë“¤ì—¬ë‹¤ë³´ë©´ì„œ ê·¸ ë™ì‘ ê³¼ì •ì„ ì´í•´í•´ ë´…ì‹œë‹¤.


tx.commit()ì˜ ë™ì‘ ê³¼ì •ì€ JPAì—ì„œ commitì´ ì´ë£¨ì–´ì§€ëŠ” ê³¼ì •ì„ ëŒ€ëµì ìœ¼ë¡œ ì´í•´í•˜ëŠ” ê²ƒì´ ëª©ì ì´ì§€ë§Œ ì´ ê³¼ì •ì„ ëª¨ë‘ ë‹¤ ì´í•´í•  í•„ìš”ëŠ” ì—†ìŠµë‹ˆë‹¤.

ì´ëŸ° ë³µì¡í•œ ê³¼ì •ì„ ê±°ì³ì„œ commitì´ ìˆ˜í–‰ëœë‹¤ëŠ” ì‚¬ì‹¤ë§Œ ì•Œê³  ìˆìœ¼ë©´ ë  ê²ƒ ê°™ìŠµë‹ˆë‹¤.




[ê·¸ë¦¼ 3-66] JPA tx.commit() í˜¸ì¶œ ê³¼ì • ì´í•´ë¥¼ ìœ„í•œ í´ë˜ìŠ¤ ë‹¤ì´ì–´ê·¸ë¨ ê´€ê³„ë„

[ê·¸ë¦¼ 3-66]ì€ JPA APIë¥¼ í†µí•´ EntityTransaction ê°ì²´ë¥¼ ì–»ì€ í›„, ì´ EntityTransaction ê°ì²´(tx)ë¡œ tx.commit() ë©”ì„œë“œë¥¼ í˜¸ì¶œí–ˆì„ ë•Œì˜ ë™ì‘ ê³¼ì •ì…ë‹ˆë‹¤.


ê·¸ë¦¼ 3-66ì—ì„œëŠ” JPAì˜ EntityTransactionê³¼ ì§ê°„ì ‘ì ìœ¼ë¡œ ê´€ê³„ë¥¼ ë§ºê³  ìˆëŠ” ì¸í„°í˜ì´ìŠ¤ ë° í´ë˜ìŠ¤ì˜ êµ¬ì„±ì„ ë‹¤ì´ì–´ê·¸ë¨ìœ¼ë¡œ ë³´ì—¬ì£¼ê³  ìˆìŠµë‹ˆë‹¤.


ë‹¤ì´ì–´ê·¸ë¨ì—ì„œ ì‹¤ì œë¡œ ìš°ë¦¬ê°€ í™•ì¸í•´ ë´ì•¼ ë  ë¶€ë¶„ì€ ë²ˆí˜¸ê°€ ë§¤ê²¨ì ¸ ìˆëŠ” í´ë˜ìŠ¤ì…ë‹ˆë‹¤.

ì´ í´ë˜ìŠ¤ë“¤ì„ í™•ì¸í•˜ë©´ tx.commit()ì„ í˜¸ì¶œí–ˆì„ ë•Œ, commitì´ ë˜ëŠ” ê³¼ì •ì„ ëŒ€ëµì ìœ¼ë¡œ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤.


TransactionImpl

```java
package org.hibernate.engine.transaction.internal;

public class TransactionImpl implements TransactionImplementor {
			...
			...
			@Override
			public void commit() {
				...
				...
				try {
					internalGetTransactionDriverControl().commit(); // (1)
				}
				catch (RuntimeException e) {
					throw session.getExceptionConverter().convertCommitException( e );
				}
			}
}
```
[3-150] Transactionlmpl í´ë˜ìŠ¤ì˜ ë‚´ë¶€ ì½”ë“œ ì¼ë¶€

JPA EntityTransaction ê°ì²´(tx)ë¡œ tx.commit()ì„ í˜¸ì¶œí•˜ëŠ” ê²ƒì€ EntityTransaction ì¸í„°í˜ì´ìŠ¤ì˜ êµ¬í˜„ í´ë˜ìŠ¤ì¸ TransactionImpl í´ë˜ìŠ¤ì˜ commit()ì„ í˜¸ì¶œí•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.


TransactionImpl í´ë˜ìŠ¤ì—ì„œëŠ” (1)ê³¼ ê°™ì´ ë¬¼ë¦¬ì ì¸ íŠ¸ëœì­ì…˜ì„ ì œì–´í•˜ê¸° ìœ„í•œ ë¡œì»¬ íŠ¸ëœì­ì…˜ ë“œë¼ì´ë²„ êµ¬í˜„ ê°ì²´(TransactionDriverControlImpl)ë¥¼ ì–»ì€ í›„ì— êµ¬í˜„ ë©”ì„œë“œì¸ commit()ì„ ë‹¤ì‹œ í˜¸ì¶œí•©ë‹ˆë‹¤


JdbcResourceLocalTransactionCoordinatorImpl > TransactionDriverControlImpl

```java
package org.hibernate.resource.transaction.backend.jdbc.internal;

public class JdbcResourceLocalTransactionCoordinatorImpl 
										implements TransactionCoordinator {
			...
			...
			public class TransactionDriverControlImpl implements TransactionDriver {
						@Override
						public void commit() {
							try {
								...
								...
								JdbcResourceLocalTransactionCoordinatorImpl
									       	.this.beforeCompletionCallback();
								jdbcResourceTransaction.commit();  // (1)
								JdbcResourceLocalTransactionCoordinatorImpl
										.this.afterCompletionCallback( true );
							}
							catch (RollbackException e) {
								throw e;
							}
							catch (RuntimeException e) {
								try {
									rollback();
								}
								catch (RuntimeException e2) {
									log.debug( "Encountered failure rolling back failed commit", e2 );
								}
								throw e;
							}
						}
			}
}
```
[3-151] JdbcResourceLocalTransactionCoordinatorImpl > TransactionDriverControlImpl í´ë˜ìŠ¤ì˜ ë‚´ë¶€ ì½”ë“œ ì¼ë¶€

TransactionDriverControlImplì—ì„œëŠ” (1)ê³¼ ê°™ì´ JDBC Connectionì˜ ì•¡ì„¸ìŠ¤ ë°©ë²•ì„ ì œê³µí•˜ëŠ” JdbcResourceTransactionì˜ êµ¬í˜„ ê°ì²´ì¸ AbstractLogicalConnectionImplementorì˜ commit()ì„ ë‹¤ì‹œ í˜¸ì¶œí•©ë‹ˆë‹¤.


AbstractLogicalConnectionImplementor

```java
package org.hibernate.resource.jdbc.internal;

public abstract class AbstractLogicalConnectionImplementor 
				implements LogicalConnectionImplementor, PhysicalJdbcTransaction {
			...
			...
			@Override
			public void begin() {
					...	
			}
			
			@Override
			public void commit() {
				try {
					getConnectionForTransactionManagement().commit(); // (1)
					status = TransactionStatus.COMMITTED;
	
				}
				catch( SQLException e ) {
					status = TransactionStatus.FAILED_COMMIT;
				}
				afterCompletion();
			}
	
			...
			...
			@Override
			public void rollback() {
				try {
					getConnectionForTransactionManagement().rollback();
					status = TransactionStatus.ROLLED_BACK;
				}
				catch( SQLException e ) {
					status = TransactionStatus.FAILED_ROLLBACK;
				}
		
				afterCompletion();
			}
}
```
[3-152] AbstractLogicalConnectionImplementor í´ë˜ìŠ¤ì˜ ë‚´ë¶€ ì½”ë“œ ì¼ë¶€

(1)ì—ì„œ ì‹¤ì œ ë¬¼ë¦¬ì ì¸ JDBC Connectionì„ ì–»ì€ í›„ì— ì´ connection ê°ì²´ì˜ commit()ì„ ë‹¤ì‹œ í˜¸ì¶œí•©ë‹ˆë‹¤.


ì—¬ê¸°ê¹Œì§€ê°€ Hibernate ORMì—ì„œì˜ ì˜ì—­ì…ë‹ˆë‹¤.

ì´ì œ ë¬¼ë¦¬ì ì¸ JDBC Connectionì„ í†µí•´ ë°ì´í„°ë² ì´ìŠ¤ì™€ ì¸í„°ë™ì…˜ í•˜ê¸° ìœ„í•´ì„œ JDBC APIì˜ êµ¬í˜„ì²´ì¸ JdbcConnection ì˜ì—­ìœ¼ë¡œ ì´ë™í•©ë‹ˆë‹¤.


ìš°ë¦¬ëŠ” ì¸ë©”ëª¨ë¦¬ DBì¸ H2ë¥¼ ì‚¬ìš©í•˜ê¸° ìˆê¸° ë•Œë¬¸ì— H2ì—ì„œ ì œê³µí•˜ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•  ê²ƒì…ë‹ˆë‹¤.


JdbcConnection

```java
package org.h2.jdbc;

public class JdbcConnection extends TraceObject 
		implements Connection, JdbcConnectionBackwardsCompat, CastDataProvider {
			...
			...
			
			@Override
	    public synchronized void commit() throws SQLException {
	        try {
	            ...
							...
	            commit = prepareCommand("COMMIT", commit);  // (1)
	            commit.executeUpdate(null);    // (2)
	        } catch (Exception e) {
	            throw logAndConvert(e);
	        }
	    }
}
```
[3-153] JdbcConnection í´ë˜ìŠ¤ì˜ ë‚´ë¶€ ì½”ë“œ ì¼ë¶€

ì½”ë“œ 3-153ì˜ JdbcConnectionë¶€í„°ëŠ” JDBC APIì˜ êµ¬í˜„ì²´ì¸ H2ì˜ ì˜ì—­ì…ë‹ˆë‹¤.

(1)ì—ì„œ ë°ì´í„°ë² ì´ìŠ¤ì— commit ëª…ë ¹ì„ ì¤€ë¹„í•œ í›„, (2)ì—ì„œ í•´ë‹¹ ëª…ë ¹ì„ ì‹¤í–‰í•©ë‹ˆë‹¤.

(1)ê³¼ (2)ì˜ ë©”ì„œë“œ í˜¸ì¶œì€ H2ì—ì„œ ì§€ì›í•˜ëŠ” Command í´ë˜ìŠ¤ì—ì„œ ì´ë£¨ì–´ì§‘ë‹ˆë‹¤.


Command

```java
package org.h2.command;

public abstract class Command implements CommandInterface {
			...
			...
			@Override
	    public ResultWithGeneratedKeys executeUpdate(Object generatedKeysRequest) {
	        long start = 0;
	        Database database = session.getDatabase();
	        session.waitIfExclusiveModeEnabled();
	        boolean callStop = true;
	        //noinspection SynchronizationOnLocalVariableOrMethodParameter
	        synchronized (session) {
	            commitIfNonTransactional();  // (1) 
	            SessionLocal.Savepoint rollback = session.setSavepoint();
	            session.startStatementWithinTransaction(this);
	            DbException ex = null;
	            Session oldSession = session.setThreadLocalSession();
	            try {
		              ...
									...
	            } catch (DbException e) {
	                e = e.addSQL(sql);
	                ...
									...
	                try {
	                    database.checkPowerOff();
	                    if (s.getErrorCode() == ErrorCode.DEADLOCK_1) {
	                        session.rollback();    // (2)
	                    } else {
	                        session.rollbackTo(rollback);
	                    }
	                } catch (Throwable nested) {
	                    e.addSuppressed(nested);
	                }
	                ex = e;
	                throw e;
	            } finally {
	                ...
									...
	            }
	        }
	    }
	
	    private void commitIfNonTransactional() {
	        if (!isTransactional()) {
	            boolean autoCommit = session.getAutoCommit();   // (3)
	            session.commit(true);   // (4)
	            if (!autoCommit && session.getAutoCommit()) {
	                session.begin();
	            }
	        }
	    }
}
```
[3-154] Command í´ë˜ìŠ¤ì˜ ë‚´ë¶€ ì½”ë“œ ì¼ë¶€

ë°ì´í„°ë² ì´ìŠ¤ì— commit ëª…ë ¹ì„ ì „ë‹¬í•˜ê¸° ìœ„í•´ (1)ì—ì„œ commitIfNonTransactional() ë©”ì„œë“œë¥¼ í˜¸ì¶œí•©ë‹ˆë‹¤.

commitIfNonTransactional() ë©”ì„œë“œ ë‚´ë¶€ì—ì„œëŠ” (3)ì—ì„œ auto commit ì—¬ë¶€ë¥¼ ì²´í¬í•œ í›„, (4)ì™€ ê°™ì´ ë°ì´í„°ë² ì´ìŠ¤ ì„¸ì…˜ì— í•´ë‹¹í•˜ëŠ” Session ê°ì²´ë¥¼ í†µí•´ commit ëª…ë ¹ì„ ìˆ˜í–‰í•˜ê³  ìˆìŠµë‹ˆë‹¤.


ë§Œì•½ì— commitIfNonTransactional() ìˆ˜í–‰ ê³¼ì •ì—ì„œ ì˜ˆì™¸ê°€ ë°œìƒí•˜ë©´ (2)ì™€ ê°™ì´ rollbackì„ ìˆ˜í–‰í•˜ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.


SessionLocal

```java
package org.h2.engine;

public final class SessionLocal extends Session 
        	implements TransactionStore.RollbackListener {
			...
			...
			public void commit(boolean ddl) {
        beforeCommitOrRollback();
        if (hasTransaction()) {
            try {
                markUsedTablesAsUpdated();
                transaction.commit();      // (1)
                removeTemporaryLobs(true);
                endTransaction();
            } finally {
                transaction = null;
            }
            ...
						...
        }
    }
}
```
[3-155] SessionLocal í´ë˜ìŠ¤ì˜ ë‚´ë¶€ ì½”ë“œ ì¼ë¶€

ë§ˆì§€ë§‰ìœ¼ë¡œ ë‹¤ì´ì–´ê·¸ë¨ì—ëŠ” ë‚˜ì™€ ìˆì§€ ì•Šì§€ë§Œ SessionLocal í´ë˜ìŠ¤ì—ì„œ (1)ê³¼ ê°™ì´ íŠ¸ëœì­ì…˜ì— ëŒ€í•œ commitì´ ìˆ˜í–‰ë©ë‹ˆë‹¤.


ìš°ë¦¬ê°€ JPA APIë¥¼ ì‚¬ìš©í•´ì„œ commitì„ ìˆ˜í–‰í•˜ëŠ” ì‘ì—…ì€ ë„ˆë¬´ë‚˜ë„ ê°„ë‹¨í•œ ì‘ì—…ì¸ë°, ë‚´ë¶€ì ìœ¼ë¡œëŠ” ì•„ì£¼ ë³µì¡í•œ ê³¼ì •ì„ ê±°ì³ì„œ ìµœì¢…ì ìœ¼ë¡œ commit ëª…ë ¹ì´ ë°ì´í„°ë² ì´ìŠ¤ì— ì „ë‹¬ëœë‹¤ëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.

ë˜í•œ JPA APIë¥¼ ì‚¬ìš©í•œ commit ê³¼ì •ì—ì„œ ìš°ë¦¬ê°€ í™•ì¸í•  ìˆ˜ ìˆì—ˆë˜ ë¶€ë¶„ì€ JPA ê¸°ìˆ ì„ ì‚¬ìš©í•œ ë°ì´í„°ë² ì´ìŠ¤ì™€ì˜ ì¸í„°ë™ì…˜ì€ ë‚´ë¶€ì ìœ¼ë¡œëŠ” JDBC APIë¥¼ í†µí•´ì„œ ì´ë£¨ì–´ì§„ë‹¤ëŠ” ê²ƒì…ë‹ˆë‹¤.

ê·¸ë¦¬ê³  ìš°ë¦¬ê°€ í•™ìŠµì„ ìœ„í•´ì„œ í˜„ì¬ ì‚¬ìš©í•˜ê³  ìˆëŠ” JDBC APIì˜ êµ¬í˜„ ë¼ì´ë¸ŒëŸ¬ë¦¬ëŠ” H2ì¸ ê²ƒì…ë‹ˆë‹¤. ^^


íŠ¸ëœì­ì…˜ì˜ ì§„ì •í•œ ì˜ë¯¸
íŠ¸ëœì­ì…˜ì˜ ì˜ë¯¸ë¥¼ ì´í•´í•˜ê¸° ìœ„í•´ ìš°ë¦¬ê°€ ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ì‘ì—…ì„ ì²˜ë¦¬í•˜ëŠ” ìƒí™©ì„ ì˜ˆë¡œ ë“¤ì—ˆì§€ë§Œ íŠ¸ëœì­ì…˜ì€ ì‚¬ì‹¤ ë°ì´í„°ë² ì´ìŠ¤ì—ë§Œ í•œì •í•´ì„œ ì‚¬ìš©í•˜ëŠ” ì˜ë¯¸ëŠ” ì•„ë‹™ë‹ˆë‹¤.


ì˜ˆë¥¼ ë“¤ì–´ì„œ ì–´ë–¤ ë°ì´í„°ë¥¼ ë¡œì»¬ ë°ì´í„°ë² ì´ìŠ¤ì—ë„ ì €ì¥í•˜ê³ , ê·¸ ê²°ê³¼ë¥¼ í‘¸ì‹œ ì•Œë¦¼(push notification)ìœ¼ë¡œ í´ë¼ì´ì–¸íŠ¸ì—ê²Œ ì „ì†¡í•˜ëŠ” ê¸°ëŠ¥ì´ ìˆë‹¤ë©´ ë°ì´í„°ë² ì´ìŠ¤ ì €ì¥ê³¼ í‘¸ì‹œ ì•Œë¦¼ ì „ì†¡ì´ë¼ëŠ” ë‘ ê°œì˜ ì‘ì—…ì´ í•˜ë‚˜ì˜ íŠ¸ëœì­ì…˜ìœ¼ë¡œ ë¬¶ì—¬ì„œ ë‘˜ ì¤‘ì— í•˜ë‚˜ë¼ë„ ì‹¤íŒ¨í•  ê²½ìš° ë¡¤ë°±(rollback)ì´ ë˜ì–´ì•¼ í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.(ì •ì±…ì ìœ¼ë¡œ ì´ ë‘ ê°œì˜ ì‘ì—…ì„ ë³„ê°œë¡œ ë³´ëŠ” ê²½ìš°ë„ ìˆìŠµë‹ˆë‹¤.)


ì´ì²˜ëŸ¼ ì „í˜€ ë‹¤ë¥¸ íƒ€ì…ì˜ ë¦¬ì†ŒìŠ¤(ë°ì´í„°ë² ì´ìŠ¤, íŒŒì¼, ë©”ì‹œì§€ ë“±)ë¥¼ í•˜ë‚˜ì˜ ì‘ì—… ë‹¨ìœ„ë¡œ ë¬¶ì–´ì„œ ì²˜ë¦¬í•´ì•¼ ë˜ëŠ” ìƒí™©ì—ì„œëŠ” ì–´ë–¤ ì‹ìœ¼ë¡œ íŠ¸ëœì­ì…˜ì„ ì ìš©í•˜ë©´ ì¢‹ì„ì§€ì— ëŒ€í•´ì„œ ê¼­ ê³ ë¯¼í•´ ë³´ê¸° ë°”ëë‹ˆë‹¤. (ì—¬ëŸ¬ë¶„ì˜ ì‹¤ìŠµ ê³¼ì œì—ì„œ ì´ëŸ° ìƒí™©ì„ ë§Œë‚  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ^^)



í•µì‹¬ í¬ì¸íŠ¸
íŠ¸ëœì­ì…˜ì€ ì—¬ëŸ¬ ê°œì˜ ì‘ì—…ë“¤ì„ í•˜ë‚˜ì˜ ê·¸ë£¹ìœ¼ë¡œ ë¬¶ì–´ì„œ ì²˜ë¦¬í•˜ëŠ” ì²˜ë¦¬ ë‹¨ìœ„ë¥¼ ì˜ë¯¸ í•œë‹¤.
ACID ì›ì¹™
ì›ìì„±(Atomicity)
íŠ¸ëœì­ì…˜ì—ì„œì˜ ì›ìì„±(Atomicity)ì´ë€ ì‘ì—…ì„ ë” ì´ìƒ ìª¼ê°¤ ìˆ˜ ì—†ìŒì„ ì˜ë¯¸ í•œë‹¤.
ë”°ë¼ì„œ ë…¼ë¦¬ì ìœ¼ë¡œ í•˜ë‚˜ì˜ ì‘ì—…ìœ¼ë¡œ ì¸ì‹í•´ì„œ ë‘˜ ë‹¤ ì„±ê³µí•˜ë“  ë‘˜ ë‹¤ ì‹¤íŒ¨í•˜ë“ ê°€(All or Nothing)ì˜ ë‘˜ ì¤‘ í•˜ë‚˜ë¡œë§Œ ì²˜ë¦¬ë˜ëŠ” ê²ƒì´ ë³´ì¥ëœë‹¤.
ì¼ê´€ì„±(Consistency)
ì¼ê´€ì„±(Consistency)ì€ íŠ¸ëœì­ì…˜ì´ ì—ëŸ¬ ì—†ì´ ì„±ê³µì ìœ¼ë¡œ ì¢…ë£Œë  ê²½ìš°, ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì—ì„œ ì˜ë„í•˜ëŠ” ëŒ€ë¡œ ì¼ê´€ì„± ìˆê²Œ ì €ì¥ë˜ê±°ë‚˜ ë³€ê²½ë˜ëŠ” ê²ƒì„ ì˜ë¯¸ í•œë‹¤.
ê³ ë¦½ì„±(Isolation)
ê³ ë¦½ì„±(Isolation)ì€ ì—¬ëŸ¬ ê°œì˜ íŠ¸ëœì­ì…˜ì´ ì‹¤í–‰ë  ê²½ìš° ê°ê° ë…ë¦½ì ìœ¼ë¡œ ì‹¤í–‰ì´ ë˜ì–´ì•¼ í•¨ì„ ì˜ë¯¸ í•œë‹¤.
ì§€ì†ì„±(Durability)
ì§€ì†ì„±(Durability)ì€ ì—¬ëŸ¬ë¶„ë“¤ì´ ì˜ ì•Œê³  ìˆë‹¤ì‹œí”¼ ë°ì´í„°ë² ì´ìŠ¤ê°€ ì¢…ë£Œë˜ì–´ë„ ë°ì´í„°ëŠ” ë¬¼ë¦¬ì ì¸ ì €ì¥ì†Œì— ì €ì¥ë˜ì–´ ì§€ì†ì ìœ¼ë¡œ ìœ ì§€ë˜ì–´ì•¼ í•œë‹¤ëŠ” ì˜ë¯¸ í•œë‹¤.
ì»¤ë°‹(commit)
ì»¤ë°‹(commit)ì€ ëª¨ë“  ì‘ì—…ì„ ìµœì¢…ì ìœ¼ë¡œ ë°ì´í„°ë² ì´ìŠ¤ì— ë°˜ì˜í•˜ëŠ” ëª…ë ¹ì–´ë¡œì¨  commit ëª…ë ¹ì„ ìˆ˜í–‰í•˜ë©´ ë³€ê²½ëœ ë‚´ìš©ì´ ë°ì´í„°ë² ì´ìŠ¤ì— ì˜êµ¬ì ìœ¼ë¡œ ì €ì¥ëœë‹¤.
ë§Œì•½ commit ëª…ë ¹ì„ ìˆ˜í–‰í•˜ì§€ ì•Šìœ¼ë©´ ì‘ì—…ì˜ ê²°ê³¼ê°€ ë°ì´í„°ë² ì´ìŠ¤ì— ìµœì¢…ì ìœ¼ë¡œ ë°˜ì˜ë˜ì§€ ì•ŠëŠ”ë‹¤.
commit ëª…ë ¹ì„ ìˆ˜í–‰í•˜ë©´, í•˜ë‚˜ì˜ íŠ¸ëœì ì…˜ ê³¼ì •ì€ ì¢…ë£Œí•˜ê²Œ ëœë‹¤.
ë¡¤ë°±(rollback)
ë¡¤ë°±(rollback)ì€ ì‘ì—… ì¤‘ ë¬¸ì œê°€ ë°œìƒí–ˆì„ ë•Œ, íŠ¸ëœì­ì…˜ ë‚´ì—ì„œ ìˆ˜í–‰ëœ ì‘ì—…ë“¤ì„ ì·¨ì†Œí•œë‹¤.
ë”°ë¼ì„œ íŠ¸ëœì­ì…˜ ì‹œì‘ ì´ ì „ì˜ ìƒíƒœë¡œ ë˜ëŒì•„ê°„ë‹¤.
JPA ê¸°ìˆ ì„ ì‚¬ìš©í•œ ë°ì´í„°ë² ì´ìŠ¤ì™€ì˜ ì¸í„°ë™ì…˜ì€ ë‚´ë¶€ì ìœ¼ë¡œëŠ” JDBC APIë¥¼ í†µí•´ì„œ ì´ë£¨ì–´ì§„ë‹¤.


ì‹¬í™” í•™ìŠµ
ACID ì›ì¹™ì— ëŒ€í•´ì„œ ë” ì•Œì•„ë³´ê³  ì‹¶ë‹¤ë©´ ì•„ë˜ ë§í¬ë¥¼ ì°¸ê³ í•˜ì„¸ìš”.
https://ko.wikipedia.org/wiki/ACID

H2ì˜ commit ëª…ë ¹ì–´ì— ëŒ€í•´ì„œ ë” ì•Œì•„ë³´ê³  ì‹¶ë‹¤ë©´ ì•„ë˜ ë§í¬ë¥¼ ì°¸ê³ í•˜ì„¸ìš”.
https://www.tutorialspoint.com/h2_database/h2_database_commit.htm

H2ì˜ rollback ëª…ë ¹ì–´ì— ëŒ€í•´ì„œ ë” ì•Œì•„ë³´ê³  ì‹¶ë‹¤ë©´ ì•„ë˜ ë§í¬ë¥¼ ì°¸ê³ í•˜ì„¸ìš”.
https://www.tutorialspoint.com/h2_database/h2_database_rollback.htm

H2ë¥¼ í†µí•´ JDBC Connectionì„ ì‚¬ìš©í•˜ëŠ” ë°©ë²•ì„ ë” ì•Œì•„ë³´ê³  ì‹¶ë‹¤ë©´ ì•„ë˜ ë§í¬ë¥¼ ì°¸ê³ í•˜ì„¸ìš”.
https://www.tutorialspoint.com/h2_database/h2_database_jdbc_connection.htm
